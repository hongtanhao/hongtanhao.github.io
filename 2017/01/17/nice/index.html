






<!doctype html>
<html lang="">
<head>
  <meta http-equiv="Content-Type" content="text/html" charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  
  <meta name="author" content="feng">
  
  
  
  
    <meta name="description" content="JavaScript实现本地图片上传预览功能（兼容IE、chrome、FF）时间 2012-06-29 22:22:17 ** JavaScript开发 JavaScript
需要解决的问题有：本地图片如何在上传前预览、编辑；最近发现这个功能很多是基于flash实现的，很多JavaScript实现的代码兼容性都很差，特别是在IE和firefox和chrome三个浏览器上不兼容。代码实现主要利...">
  
  <title>a delicious name! [ sofia ]</title>
  
  
    <link rel="shortcut icon" href="/favicon.ico">
  
  
  <link rel="stylesheet" href="/css/random.css">
<link rel="stylesheet" href="/css/vegas.min.css">
<link rel="stylesheet" href="/css/highlight-railscasts.css">
<link rel="stylesheet" href="/css/jquery.fancybox.css">
<link rel="stylesheet" href="/css/iconfont/iconfont.css">
<link rel="stylesheet" href="/css/jquery.fancybox-thumbs.css">
<link rel="stylesheet" href="/css/plyr.css">
  
</head>

<body>
<div class="side-navigate hide-area">
  
    <div class="item prev">
      <a href="/2017/01/23/bore/">
        <div class="item-icon"></div>
      </a>
      <div class="item-title">
        
      </div>
    </div>
  
  
    <div class="item next">
      <a href="/2017/01/17/gulp-browsersync/">
        <div class="item-icon"></div>
      </a>
      <div class="item-title">
        
      </div>
    </div>
  
</div>
<div id="outer-container" class="hide-area">
<div id="container">
  <div id="menu-outer" class="slide-down">
    <div id="menu-inner">
      <div id="brand">
        
        <a onClick="openUserCard()">
          <img id="avatar" src="http://tse1.mm.bing.net/th?&id=OIP.M42d45b1a9b6b2f352d0385649fe1e836o0&w=300&h=225&c=0&pid=1.9&rs=0&p=0&r=0"/>
          <div id="homelink">sofia</div>
        </a>
      </div>
      <div id="menu-list">
        <ul>
        
        
          
            <li>
          
            <a href="/index.html">Home</a>
            
          </li>
        
          
            <li>
          
            <a href="/archives">Archives</a>
            
          </li>
        
          
            <li>
          
            <a href="/tags">Tags</a>
            
          </li>
        
          
            <li>
          
            <a href="/categories">Categories</a>
            
          </li>
        
          
            <li>
          
            <a href="/about">About</a>
            
          </li>
        
          
            <li>
          
            <a href="https://github.com/stiekel/hexo-theme-random">Github</a>
            
          </li>
        
        </ul>
      </div>
      <div id="show-menu">
        <button>Menu</button>
      </div>
    </div>
  </div>

  <div id="content-outer">
    <div id="content-inner">
      
      
  <article id="post">
    <h1>No Title</h1>
    <p class="page-title-sub">
      <span id = "post-title-date">Created at 2017-01-17</span>
      
        <span id = "post-title-updated">Updated at 2017-01-26</span>
      
      
      
    </p>
    
    <h1 id="JavaScript实现本地图片上传预览功能（兼容IE、chrome、FF）"><a href="#JavaScript实现本地图片上传预览功能（兼容IE、chrome、FF）" class="headerlink" title="JavaScript实现本地图片上传预览功能（兼容IE、chrome、FF）"></a>JavaScript实现本地图片上传预览功能（兼容IE、chrome、FF）</h1><p>时间 2012-06-29 22:22:17 ** <a href="http://m.open-open.com/m/lib/category/145" target="_blank" rel="external">JavaScript开发</a> <a href="http://m.open-open.com/m/lib/tags/JavaScript" target="_blank" rel="external">JavaScript</a></p>
<p>需要解决的问题有：本地图片如何在上传前预览、编辑；<br>最近发现这个功能很多是基于flash实现的，很多JavaScript实现的代码兼容性都很差，特别是在IE和firefox和chrome三个浏览器上不兼容。<br>代码实现主要利用到jquery插件imgAreaSelect，FileReader对象（chrome和ff获取本地图片数据的接口），IE滤镜效果。<br>关键词：<strong>imgAreaSelect FileReaderdocument.selection.createRange() IE滤镜效果**</strong>一、实现上传前预览1.1、页面显示**<br>代码1-1显示的是html需要展示的web页面信息<br><code>&lt;!—预览图片显示区域--&gt;</code><br><code>&lt;div id=”image_area”&gt;</code><br><code>&lt;img id=&quot;biuuu&quot;src=&quot;#&quot; title=&quot;biuuu&quot;&gt;</code><br><code>&lt;/div&gt;</code><br><code>&lt;!—图片上传区域--&gt;</code><br><code>&lt;div id =”upload_area”&gt;</code><br><code>&lt;form name = &quot;form1&quot;action =&#39; /person?c=changeAtvatar&#39; enctype = &#39;multipart/form-data&#39; method = &#39;POST&#39;&gt;</code><br><code>&lt;input type=&quot;file&quot;id=&quot;picpath&quot; name=&quot;atvatar_image&quot;&gt;</code><br><code>&lt;a href=&quot;javascript:void(0);&quot;class=&quot;button&quot;&gt; 上传照片&lt;/a&gt;</code><br><code>&lt;input type=&#39;text&#39;name=&quot;path&quot; readonly&gt;</code><br><code>&lt;div id = “submit_button”&gt;</code><br><code>&lt;a href=&quot;javascript:void(0);&quot;class=&#39;button&#39;&gt;确认&lt;/a&gt;</code><br><code>&lt;/div&gt;</code><br>​                                                          代码1-1</p>
<p>为了修改input file的按钮名称，我们添加了一段代码，这个在第二节将会详细说明<br>​           <code>&lt;a href=&quot;javascript:void(0);&quot; class=&quot;button&quot;&gt;上传照      片&lt;/a&gt;&lt;input type=&#39;text&#39;name=&quot;path&quot; readonly&gt;</code><br><strong>1.2、实现预览在线编辑</strong><br>这里我们主要使用了一个插件进行图片编辑，如果需要具体查看学习可查看网址<br><a href="http://odyniec.net/projects/imgareaselect/" target="_blank" rel="external">http://odyniec.net/projects/imgareaselect/</a>，使用方法还是很简单方便的。<br><code>$(&#39;#biuuu&#39;).imgAreaSelect({`
`aspectRatio:&#39;1:1&#39;, //截取比例`
`show:true,`
`resizable:true, //是否可调整大小`
`autoHide: false,//选择框选择完毕是否自己取消`
`handles:true,`
`key:true, //是否启用键盘，默认为false`
`//x1: 75, y1: 30, x2:225, y2: 180, //需要处理的区域，原始的`
`//x1:左上角x轴坐标 y1:左上角y轴坐标 x2:右下角x轴坐标 y2:右下角y轴坐标`
`keys: { arrows: 1,ctrl: 5, shift: &#39;resize&#39; }, //调整像素大小`
`//onInit:function(img, selection) { ias.setSelection(100, 50, 250, 150, true);ias.update(); }, //设置初始函数 画出选择框`
`onSelectChange:preview //选框移动时触发的事件`
`//onSelectEnd:function(img, select){alert(select.width)} //选框结束时触发的事件`
`});</code></p>
<p>​                                    代码1-2</p>
<p>代码1-2主要是设置需要编辑图片的一些插件属性，具体查看插件的参量说明。<br>首先我们需要创建一个预览小图片在img之后<br><code>$(&#39;&lt;div&gt;&lt;imgid=&quot;view&quot; src=&#39;+atvatarUrl+&#39; style=&quot;position: relative;&quot;/&gt;&lt;/div&gt;&#39;)</code><br><code>.css({</code><br><code>float: &#39;left&#39;,</code><br><code>position:&#39;relative&#39;,</code><br><code>overflow:&#39;hidden&#39;,</code><br><code>width: &#39;100px&#39;,</code><br><code>height: &#39;100px&#39;</code><br><code>}).insertAfter(&#39;#biuuu&#39;);//把新建元素放到 #biuuu 之后</code></p>
<p>  <code>代码1-3代码1-3是创建一个小预览图片在img之后</code></p>
<p>`<strong>1.3、实现在线预览功能</strong></p>
<p><code>function previewImage(file)</code><br><code>{</code><br><code>var porImg = $(&#39;#biuuu&#39;),//首先获取大图片jquery对象</code><br><code>viewImg = $(&#39;#view&#39;);//小图片jquery对象</code><br>//判断该浏览器是否为w3c标准，既非IE浏览器<br><code>if (file[&quot;files&quot;] &amp;&amp; file[&quot;files&quot;][0])</code><br><code>{</code><br><code>//使用JavaScript的FileReader对象来读取本地数据，并且将数据结果赋值给image的src，具体该对象如何实现的还未深入研究</code><br><code>var reader = newFileReader();</code><br><code>reader.onload =function(evt){</code><br><code>porImg.attr({src :evt.target.result});</code><br><code>viewImg.attr({src: evt.target.result});</code><br><code>}</code><br><code>reader.readAsDataURL(file.files[0]);</code><br><code>}</code><br>//如果是IE浏览器，采用滤镜效果，进行显示，但特别注意的是该滤镜效果使用的对象是div对象，并非img对象，因此我们需要将原有的img对象remove同时生成新的div对象，并且赋值相应的class和id<br><code>else</code><br><code>{</code><br><code>//创建需要滤镜显示的div的dom对象</code><br><code>var ieImageDom =document.createElement(&quot;div&quot;);</code><br><code>var proIeImageDom =document.createElement(&quot;div&quot;);</code><br><code>//设置对象的css属性和原有的img对象属性相同，添加相应的id属性值</code><br><code>$(ieImageDom).css({</code><br><code>float: &#39;left&#39;,</code><br><code>position:&#39;relative&#39;,</code><br><code>overflow:&#39;hidden&#39;,</code><br><code>width: &#39;100px&#39;,</code><br><code>height: &#39;100px&#39;</code><br><code>}).attr({&quot;id&quot;:&quot;view&quot;});</code><br><code>$(proIeImageDom).attr({&quot;id&quot;:&quot;biuuu&quot;});</code><br><code>//删除原有img对象，append创建div的dom对象</code><br><code>porImg.parent().prepend(proIeImageDom);</code><br><code>porImg.remove();</code><br><code>viewImg.parent().append(ieImageDom);</code><br><code>viewImg.remove();</code><br><code>//采用滤镜效果生成图片预览</code><br><code>file.select();</code><br><code>path =document.selection.createRange().text;</code><br><code>$(ieImageDom).css({&quot;filter&quot;:&quot;progid:DXImageTransform.Microsoft.AlphaImageLoader(enabled=&#39;true&#39;,sizingMethod=&#39;scale&#39;,src=\&quot;&quot;+ path + &quot;\&quot;)&quot;});</code><br><code>$(proIeImageDom).css({&quot;filter&quot;:&quot;progid:DXImageTransform.Microsoft.AlphaImageLoader(enabled=&#39;true&#39;,sizingMethod=&#39;scale&#39;,src=\&quot;&quot;+ path + &quot;\&quot;)&quot;});</code><br><code>// .style.filter =&quot;progid:DXImageTransform.Microsoft.AlphaImageLoader(enabled=&#39;true&#39;,sizingMethod=&#39;scale&#39;,src=\&quot;&quot;+ path + &quot;\&quot;)&quot;;//使用滤镜效果</code><br>`}``</p>

  </article>
  <div class="random-toc-area">
  <button class="btn-hide-toc btn-hide-toc-show" style="display: none" onclick="TOCToggle()">Show TOC</button>
  <button class="btn-hide-toc btn-hide-toc-hide" onclick="TOCToggle()">Hide TOC</button>
  <div class="random-toc">
    <h2>Table of Content</h2>
    <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#JavaScript实现本地图片上传预览功能（兼容IE、chrome、FF）"><span class="toc-text">JavaScript实现本地图片上传预览功能（兼容IE、chrome、FF）</span></a></li></ol>
  </div>
</div>

  
<nav id="pagination">
  
    <a href="/2017/01/23/bore/" class="prev">&larr; Prev post </a>
  

  

  
    <a href="/2017/01/17/gulp-browsersync/" class="next">Next post  &rarr;</a>
  
</nav>

  <!-- JiaThis Button BEGIN -->

<!-- JiaThis Button END -->


      
      
      
    </div>
  </div>

  <div id="bottom-outer">
    <div id="bottom-inner">
      Site by feng using
      <a href="http://hexo.io">Hexo</a> & <a href="https://github.com/stiekel/hexo-theme-random">Random</a>
      <br>
      
    </div>
  </div>
</div>

</div>



<div id="user-card">
  <div class="center-field">
    <img class="avatar" src="http://tse1.mm.bing.net/th?&id=OIP.M42d45b1a9b6b2f352d0385649fe1e836o0&w=300&h=225&c=0&pid=1.9&rs=0&p=0&r=0">
    <p id="description"></p>
    <ul class="social-icon">
  
  
    <li>
      <a href="https://github.com/hongtanhao">
        
          <i class="icon iconfont github">&#xe606;</i>
        
      </a>
    </li>
  
    <li>
      <a href="https://coding.net/u/antartec">
        
          <i class="icon iconfont coding">&#xe607;</i>
        
      </a>
    </li>
  
    <li>
      <a href="https://twitter.com/antartec2">
        
          <i class="icon iconfont twitter">&#xe600;</i>
        
      </a>
    </li>
  
    <li>
      <a href="https://www.douban.com/">
        
          <i class="icon iconfont douban">&#xe60f;</i>
        
      </a>
    </li>
  
    <li>
      <a href="http://esofa.applinzi.com">
        
          <i><img src="http://wx2.sinaimg.cn/mw690/006msX1uly1fbtl3m54x8j305k05kglg.jpg" width="30px" height="30px"/></i>
        
      </a>
    </li>
  
</ul>
  </div>
</div>


<div id="btn-view">Hide</div>

<script>
// is trigger analytics / tongji script
var isIgnoreHost = false;

if(window && window.location && window.location.host) {
  isIgnoreHost = ["localhost","127.0.0.1"].some(function(address){
    return 0 === window.location.host.indexOf(address);
  });
}

var isTriggerAnalytics = !( true && isIgnoreHost );

</script>




  
  
    <script src="/js/jquery-2.2.3.min.js"></script>
  
    <script src="/js/vegas.min.js"></script>
  
    <script src="/js/random.js"></script>
  
    <script src="/js/highlight.pack.js"></script>
  
    <script src="/js/jquery.mousewheel.pack.js"></script>
  
    <script src="/js/jquery.fancybox.pack.js"></script>
  
    <script src="/js/jquery.fancybox-thumbs.js"></script>
  
    <script src="/js/plyr.js"></script>
  

<script>

  // fancybox
  var backgroundImages = [];
  
  $('#post').each(function(i){
    $(this).find('img').each(function(){
      if ($(this).parent().hasClass('fancybox') || $(this).parent().hasClass('fancybox-thumb')) return;
      var alt = this.alt || this.title;
      if (alt) $(this).after('<span class="caption">' + alt + '</span>');
      $(this).wrap('<a href="' + this.src + '" title="' + alt + '" class="fancybox"></a>');
    });
    $(this).find('.fancybox').each(function(){
      $(this).attr('rel', 'post' + i);
    });
  });
  $(".fancybox").fancybox();

var vegasConfig = {"preload­Image":true,"transition":["slideLeft2","slideRight2","flash2"],"timer":true,"delay":5000,"shuffle":true,"count":28};
var unsplashConfig = {"gravity":"north"};
// is show background images
var turnoffBackgroundImage = false;



  turnoffBackgroundImage = true;


var backgroundColor = "34495E";

$(".fancybox-thumb").fancybox({
  prevEffect: 'none',
  nextEffect: 'none',
  helpers: {
    title: {
      type: 'outside'
    },
    thumbs: {
      width: 50,
      height: 50
    }
  }
});

// show video with plyr
$(".video-container iframe").each(function(i){
  var url = $(this).attr('src');
  var id = url.split('/').pop();
  var plyrContainer = document.createElement('div');
  plyrContainer.className = 'plyr';
  var plyrElement = document.createElement('div');
  plyrElement.dataset.videoId = id;
  switch(true) {
    case url.search('youtube.com') >= 0:
      plyrElement.dataset.type = 'youtube';
      break;
    case url.search('vimeo.com') >= 0:
      plyrElement.dataset.type = 'vimeo';
      break;
    default:
      return;
  };
  plyrContainer.appendChild(plyrElement);
  $(this).parent().html(plyrContainer);
});
plyr.setup('.plyr', {iconUrl: '/css/sprite.svg'});
</script>
</body>
</html>

